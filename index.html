<!DOCTYPE html>
<html lang="en" data-color-scheme="light">
<head>
  <meta charset="UTF-8" />
  <title>GenAppXpress – AI App Scaffolder</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="description" content="Instantly scaffold full‑stack & AI agentic applications with visual wizard + script export." />
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='64' height='64' viewBox='0 0 24 24' fill='none' stroke='%230c8a94' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M12 2 2 7l10 5 10-5-10-5Z'/%3E%3Cpath d='m2 17 10 5 10-5'/%3E%3Cpath d='m2 12 10 5 10-5'/%3E%3C/svg%3E"/>
  <!-- Fonts (system fallback heavy) -->
  <style>
    :root {
      /* Color Primitives */
      --color-white: #ffffff; --color-black:#000; --color-cream-50:#fcfcf9; --color-cream-100:#fffffd;
      --color-gray-200:#f5f5f5; --color-gray-300:#a7a9a9; --color-gray-400:#777c7c; --color-slate-500:#626c71;
      --color-brown-600:#5e5240; --color-charcoal-700:#1f2121; --color-charcoal-800:#262828; --color-slate-900:#13343b;
      --color-teal-300:#32b8c6; --color-teal-400:#2da6b2; --color-teal-500:#21808d; --color-teal-600:#1d7480; --color-teal-700:#1a6873; --color-teal-800:#2996a1;
      --color-red-400:#ff5459; --color-red-500:#c0152f; --color-orange-400:#e68161; --color-orange-500:#a84b2f;
      /* Semantic (light) */
      --color-background: var(--color-cream-50);
      --color-surface: var(--color-cream-100);
      --color-text: var(--color-slate-900);
      --color-text-secondary: var(--color-slate-500);
      --color-primary: var(--color-teal-500);
      --color-primary-hover: var(--color-teal-600);
      --color-primary-active: var(--color-teal-700);
      --color-border: rgba(0,0,0,0.12);
      --color-border-strong: rgba(0,0,0,0.22);
      --color-elevated: #fff;
      --color-success: #218b57;
      --color-warning: #a86a00;
      --color-error: var(--color-red-500);
      --shadow-sm: 0 1px 2px rgba(0,0,0,0.08); --shadow-md:0 4px 12px rgba(0,0,0,0.12); --shadow-lg:0 6px 20px rgba(0,0,0,0.18);
      --font-family-base: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      --font-family-mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      --font-size-xs:11px; --font-size-sm:12px; --font-size-base:14px; --font-size-md:14px; --font-size-lg:16px; --font-size-xl:18px; --font-size-2xl:20px; --font-size-3xl:24px; --font-size-4xl:30px;
      --font-weight-normal:400; --font-weight-medium:500; --font-weight-semibold:550; --font-weight-bold:600;
      --space-0:0; --space-1:1px; --space-2:2px; --space-4:4px; --space-6:6px; --space-8:8px; --space-10:10px; --space-12:12px; --space-16:16px; --space-20:20px; --space-24:24px; --space-32:32px;
      --radius-sm:6px; --radius-base:8px; --radius-md:10px; --radius-lg:12px; --radius-full:9999px;
      --duration-fast:120ms; --duration-normal:220ms; --duration-slow:420ms;
      --ease-standard:cubic-bezier(.4,0,.2,1);
    }
    [data-color-scheme="dark"] {
      --color-background: var(--color-charcoal-700);
      --color-surface: var(--color-charcoal-800);
      --color-text: var(--color-gray-200);
      --color-text-secondary: rgba(167,169,169,0.7);
      --color-primary: var(--color-teal-300);
      --color-primary-hover: var(--color-teal-400);
      --color-primary-active: var(--color-teal-800);
      --color-border: rgba(255,255,255,0.14);
      --color-border-strong: rgba(255,255,255,0.28);
      --color-elevated: #222;
      --shadow-sm: 0 1px 2px rgba(0,0,0,0.5); --shadow-md:0 4px 12px rgba(0,0,0,0.55); --shadow-lg:0 6px 20px rgba(0,0,0,0.6);
    }
    html,body {height:100%;}
    body {margin:0; font-family:var(--font-family-base); background:var(--color-background); color:var(--color-text); -webkit-font-smoothing:antialiased;}
    h1,h2,h3 {font-weight:var(--font-weight-bold); line-height:1.15; letter-spacing:-0.5px; margin:0 0 var(--space-16);} 
    p {line-height:1.5;}
    button {font-family:inherit; font-size:var(--font-size-base); cursor:pointer; border-radius:var(--radius-base); border:1px solid var(--color-border); background:var(--color-primary); color:#fff; padding:8px 16px; font-weight:var(--font-weight-medium); transition:all var(--duration-normal) var(--ease-standard);} 
    button:hover {background:var(--color-primary-hover);} button:active{background:var(--color-primary-active);} button:focus-visible{outline:2px solid var(--color-primary); outline-offset:2px;}
    a {color:var(--color-primary); text-decoration:none;} a:hover{text-decoration:underline;}
    .app-shell {max-width:1480px; margin:0 auto; padding:var(--space-24) var(--space-24) 160px;}
    header {display:flex; align-items:center; gap:var(--space-16); margin-bottom:var(--space-24);}
    .logo {width:44px;height:44px;display:grid;place-items:center;border-radius:var(--radius-lg);background:linear-gradient(135deg,var(--color-teal-500),var(--color-teal-300));color:#fff;font-weight:600;font-size:18px;box-shadow:var(--shadow-md);}
    .title-block {flex:1;}
    .title-block h1 {font-size:var(--font-size-3xl); margin:0 0 4px;}
    .title-block .tagline {font-size:var(--font-size-sm); color:var(--color-text-secondary);}
    .theme-toggle {background:var(--color-surface); color:var(--color-text); border:1px solid var(--color-border);}
    .theme-toggle:hover {background:var(--color-elevated);} 
    .wizard {display:grid; gap:var(--space-24);} 
    .steps-bar {display:flex; flex-wrap:wrap; gap:12px;}
    .step-indicator {width:42px;height:42px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:500;font-size:13px;background:var(--color-surface);color:var(--color-text-secondary);border:2px solid var(--color-border);transition:all var(--duration-normal) var(--ease-standard);position:relative;}
    .step-indicator.active {background:var(--color-primary); color:#fff; border-color:var(--color-primary);} 
    .step-indicator.completed {background:var(--color-success); color:#fff; border-color:var(--color-success);} 
    .wizard-panels {position:relative;}
    .wizard-step {display:none; animation:fadeIn .3s var(--ease-standard);} .wizard-step.active{display:block;}
    @keyframes fadeIn {from {opacity:0; transform:translateY(10px);} to {opacity:1; transform:translateY(0);} }
    .grid {display:grid; gap:16px;} 
    .tech-grid {display:grid; gap:14px; grid-template-columns:repeat(auto-fill,minmax(240px,1fr));}
    .section {background:var(--color-surface); border:1px solid var(--color-border); padding:20px 20px 28px; border-radius:var(--radius-lg); box-shadow:var(--shadow-sm); position:relative;}
    .section h2 {margin-top:0; font-size:18px;}
    .inline-fields {display:flex; flex-wrap:wrap; gap:14px;}
    .field {display:flex; flex-direction:column; gap:6px; flex:1 1 240px;}
    .field label {font-size:12px; font-weight:500; letter-spacing:.5px; text-transform:uppercase; color:var(--color-text-secondary);} 
    .field input,.field select,.field textarea {font:inherit; padding:10px 12px; border-radius:var(--radius-base); border:1px solid var(--color-border); background:var(--color-elevated); color:var(--color-text); resize:vertical; min-height:42px;}
    .field textarea {min-height:90px;}
    .actions-bar {display:flex; gap:12px; justify-content:space-between; margin-top:24px; align-items:center; flex-wrap:wrap;}
    .nav-buttons {display:flex; gap:12px;}
    .pill {font-size:11px; padding:4px 8px; border-radius:var(--radius-full); background:var(--color-primary); color:#fff; font-weight:500; letter-spacing:.5px;}
    .tech-option {display:flex; flex-direction:column; gap:6px; padding:16px 14px 14px; border:2px solid var(--color-border); border-radius:var(--radius-lg); background:var(--color-elevated); cursor:pointer; position:relative; transition:all var(--duration-normal) var(--ease-standard); min-height:120px;}
    .tech-option:hover {border-color:var(--color-primary); box-shadow:var(--shadow-md);} 
    .tech-option.selected {border-color:var(--color-primary); background:rgba(33,128,141,0.06);} 
    .tech-option.incompatible {opacity:.45; cursor:not-allowed; border-color:var(--color-error);} 
    .tech-option h4 {margin:0 0 4px; font-size:14px; font-weight:600;}
    .tech-option p {margin:0; font-size:12px; color:var(--color-text-secondary); line-height:1.4;}
    .checkbox {position:absolute; top:10px; right:10px; width:20px; height:20px; display:grid; place-items:center; border:2px solid var(--color-border); border-radius:6px; background:var(--color-surface); font-size:13px; font-weight:600; color:var(--color-primary);} 
    .tech-option.selected .checkbox {background:var(--color-primary); color:#fff; border-color:var(--color-primary);} 
    .badge-bar {display:flex; gap:6px; flex-wrap:wrap;}
    .warning {background:rgba(255,180,0,0.1); border:1px solid rgba(255,180,0,0.4); padding:10px 12px; border-radius:var(--radius-base); font-size:12px; color:#d29700; display:flex; gap:8px; align-items:flex-start;}
    .error {background:rgba(255,72,72,0.1); border:1px solid rgba(255,72,72,0.5); padding:10px 12px; border-radius:var(--radius-base); font-size:12px; color:#d92323; display:flex; gap:8px; align-items:flex-start;}
    .code-block {font-family:var(--font-family-mono); font-size:12.5px; background:#111b1c; color:#d6f2f4; padding:14px 16px; border-radius:var(--radius-lg); overflow:auto; line-height:1.4; border:1px solid #083940; max-height:420px;}
    .file-tree {font-family:var(--font-family-mono); font-size:12.5px; line-height:1.5; background:var(--color-elevated); border:1px solid var(--color-border); border-radius:var(--radius-lg); padding:12px 14px; max-height:420px; overflow:auto;}
    .tree-dir {color:var(--color-primary); font-weight:600;}
  /* Two-column summary + live preview */
  .summary-columns {display:flex; gap:24px; align-items:stretch;}
  .summary-left {flex:1 1 45%; min-width:260px;}
  .summary-right {flex:1 1 55%; min-width:320px; display:flex; flex-direction:column;}
  @media (max-width:1100px){ .summary-columns {flex-direction:column;} }
  .file-preview-layout {display:flex; gap:16px; min-height:340px;}
  .file-tree-pane {flex:0 0 45%; max-width:380px;}
  .file-preview-pane {flex:1; display:flex; flex-direction:column; background:var(--color-elevated); border:1px solid var(--color-border); border-radius:8px; overflow:hidden;}
  .preview-header {font-family:var(--font-family-mono); font-size:12px; padding:8px 12px; background:rgba(0,0,0,0.05); border-bottom:1px solid var(--color-border); color:var(--color-primary); white-space:nowrap; overflow:hidden; text-overflow:ellipsis;}
  [data-color-scheme="dark"] .preview-header {background:rgba(255,255,255,0.08);}
  .preview-content {margin:0; padding:12px 14px; font-size:12px; line-height:1.4; overflow:auto; flex:1; font-family:var(--font-family-mono);}
  .preview-placeholder {padding:32px; text-align:center; opacity:0.7; font-size:14px;}
  /* Editor & diff styles */
  .editor-toolbar {display:flex; gap:8px; padding:6px 8px; border-bottom:1px solid var(--color-border); background:var(--color-surface); align-items:center;}
  .editor-toolbar button {font-size:11px; padding:4px 8px;}
  .code-editor {flex:1; position:relative; display:flex; background:#111b1c; color:#d6f2f4;}
  .code-editor textarea {flex:1; width:100%; border:none; outline:none; resize:none; background:transparent; color:inherit; font:12px/1.4 var(--font-family-mono); padding:12px 14px;}
  .code-editor .hljs-overlay {pointer-events:none; position:absolute; inset:0; overflow:auto; padding:12px 14px; font:12px/1.4 var(--font-family-mono); white-space:pre;}
  .hljs {background:transparent;}
  .diff-view {font-family:var(--font-family-mono); font-size:12px; line-height:1.3; overflow:auto; border-top:1px solid var(--color-border); max-height:160px;}
  .diff-line {display:flex; white-space:pre;}
  .diff-line.add {background:rgba(0,160,40,0.12); color:#0f6d31;}
  .diff-line.del {background:rgba(200,0,0,0.14); color:#a31515;}
  .diff-line.ctx {color:var(--color-text-secondary);}
  .diff-line .ln {width:30px; flex:0 0 30px; opacity:.55; padding-right:4px; text-align:right;}
  .diff-line code {flex:1;}
  /* Interactive tree entries */
  .tree-entry {all:unset; display:block; width:100%; text-align:left; cursor:pointer; font-family:var(--font-family-mono); font-size:12px; padding:3px 6px; border-radius:4px; border:1px solid transparent; color:var(--color-text-secondary);} 
  .tree-entry:hover:not(.dir):not(:disabled){background:rgba(0,0,0,0.06); color:var(--color-text);} 
  [data-color-scheme="dark"] .tree-entry:hover:not(.dir):not(:disabled){background:rgba(255,255,255,0.1);} 
  .tree-entry.active {background:var(--color-primary); color:#fff;} 
  .tree-entry.dir {cursor:default; font-weight:600; color:var(--color-primary);} 
  .tree-entry:disabled {opacity:.55;}
    .footer-note {margin-top:60px; font-size:11px; opacity:.65; text-align:center;}
    .template-modal {position:fixed; inset:0; background:rgba(0,0,0,0.45); display:flex; align-items:flex-start; justify-content:center; padding:60px 20px; z-index:60;} 
    .template-dialog {max-width:880px; width:100%; background:var(--color-surface); border:1px solid var(--color-border); border-radius:18px; padding:28px 34px 44px; box-shadow:var(--shadow-lg); position:relative; display:grid; gap:20px;} 
    .close-btn {position:absolute; top:14px; right:14px; background:var(--color-error); border:none; padding:4px 10px; font-size:12px;}
    .template-grid {display:grid; gap:16px; grid-template-columns:repeat(auto-fill,minmax(240px,1fr));}
    .template-card {border:1px solid var(--color-border); border-radius:14px; padding:14px 14px 54px; position:relative; background:var(--color-elevated); display:flex; flex-direction:column; gap:6px;}
    .template-card h4 {margin:0; font-size:14px; letter-spacing:.2px;}
    .template-card p {margin:0; font-size:12px; line-height:1.4; color:var(--color-text-secondary);} 
    .template-card button {position:absolute; left:12px; bottom:12px; right:12px; width:auto;}
    .secondary {background:var(--color-surface); color:var(--color-text); border:1px solid var(--color-border);} .secondary:hover{background:var(--color-elevated);} 
    .ghost {background:transparent; color:var(--color-text-secondary); border:1px dashed var(--color-border);} .ghost:hover{color:var(--color-text); background:var(--color-surface);} 
    .inline-link {font-size:12px;}
    .divider {height:1px; background:var(--color-border); margin:24px -4px 12px;}
    .tag {background:rgba(33,128,141,0.1); color:var(--color-primary); border:1px solid rgba(33,128,141,0.25); font-size:10px; font-weight:600; letter-spacing:.5px; padding:3px 6px 2px; border-radius:var(--radius-full); text-transform:uppercase;}
    .sr-only {position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0 0 0 0); white-space:nowrap; border:0;}
    @media (max-width:980px){
      .inline-fields {flex-direction:column;}
      header {flex-wrap:wrap;}
      .steps-bar {justify-content:flex-start;}
    }
  </style>
  <script>
    // Dark mode auto preference
    (function(){
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      const stored = localStorage.getItem('genappxpress-theme');
      const mode = stored || (prefersDark ? 'dark' : 'light');
      document.documentElement.setAttribute('data-color-scheme', mode);
    })();
  </script>
  <!-- React / Babel / Libraries -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css"/>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
</head>
<body>
  <div id="root" role="application" aria-label="GenAppXpress App Scaffolder"></div>
  <noscript>You need JavaScript enabled to run this application.</noscript>

  <script type="text/babel">
    const { useState, useEffect, useMemo, useCallback } = React;

    /************************************\n     * Data: Tech Stack Definitions     *
     ************************************/
    const TECH_STACK = {
      frontend: [
        {id:'react',name:'React',description:'UI library',compatible:['vite','webpack','typescript','tailwind','jest','express','fastapi'],commands:['npm install react react-dom'],configFiles:['src/App.jsx']},
        {id:'vue',name:'Vue.js',description:'Progressive framework',compatible:['vite','webpack','typescript'],commands:['npm install vue'],configFiles:['src/main.js']},
        {id:'nextjs',name:'Next.js',description:'SSR React framework',compatible:['typescript','tailwind'],commands:['npx create-next-app@latest'],configFiles:['next.config.js']},
      ],
      backend: [
        {id:'express',name:'Express.js',description:'Fast Node.js web framework',compatible:['react','vue','nextjs','postgresql','mysql','mongodb','sqlite','redis','langchain','openai'],commands:['npm install express cors helmet'],configFiles:['server/server.js']},
        {id:'fastapi',name:'FastAPI',description:'Python high-performance API',compatible:['postgresql','mysql','sqlite','langchain','openai','anthropic','gemini'],commands:['pip install fastapi uvicorn'],configFiles:['api/main.py']},
      ],
      database: [
        {id:'postgresql',name:'PostgreSQL',description:'Advanced RDBMS',compatible:['express','fastapi','springboot','django','langchain','mcp'],commands:['npm install pg'],configFiles:['database/schema.sql']},
        {id:'mongodb',name:'MongoDB',description:'Document database',compatible:['express','node'],commands:['npm install mongoose'],configFiles:['database/models']},
        {id:'redis',name:'Redis',description:'In-memory cache & store',compatible:['express','fastapi','langchain'],commands:['npm install ioredis'],configFiles:['database/redis.js']},
      ],
      tools: [
        {id:'docker',name:'Docker',description:'Containers & compose',compatible:['*'],commands:['docker --version'],configFiles:['Dockerfile','docker-compose.yml']},
        {id:'eslint',name:'ESLint',description:'Linting',compatible:['react','vue','express'],commands:['npm install -D eslint'],configFiles:['.eslintrc.cjs']},
        {id:'typescript',name:'TypeScript',description:'Static typing',compatible:['react','vue','nextjs','express'],commands:['npm install -D typescript @types/node'],configFiles:['tsconfig.json']},
      ],
      aiFrameworks: [
        {id:'langchain',name:'LangChain',description:'Chaining & agents',compatible:['openai','anthropic','gemini','xai','ollama','mcp','fastapi','express'],commands:['pip install langchain'],configFiles:['agents/agent.py']},
        {id:'crewai',name:'CrewAI',description:'Role-based multi-agent',compatible:['openai','anthropic','gemini','xai','ollama'],commands:['pip install crewai'],configFiles:['agents/crew_agent.py']},
        {id:'langgraph',name:'LangGraph',description:'Graph orchestration',compatible:['openai','anthropic','gemini'],commands:['pip install langgraph'],configFiles:['agents/graph/graph.py']},
        {id:'semantic-kernel',name:'Semantic Kernel',description:'Model-agnostic orchestration',compatible:['openai','anthropic','gemini','xai'],commands:['pip install semantic-kernel'],configFiles:['agents/sk/kernel.py']},
        {id:'autogen',name:'Microsoft AutoGen',description:'Multi-agent orchestration',compatible:['openai','anthropic','gemini'],commands:['pip install pyautogen'],configFiles:['agents/autogen/loop.py']},
      ],
      llmProviders: [
        {id:'openai',name:'OpenAI',description:'Agents + GPT models',compatible:['langchain','crewai','langgraph','semantic-kernel','autogen'],commands:['pip install openai'],configFiles:['providers/openai_client.py']},
        {id:'anthropic',name:'Anthropic',description:'Claude models',compatible:['langchain','crewai','langgraph','semantic-kernel'],commands:['pip install anthropic'],configFiles:['providers/anthropic_client.py']},
        {id:'gemini',name:'Google Gemini',description:'Multimodal models',compatible:['langchain','crewai','langgraph'],commands:['pip install google-generativeai'],configFiles:['providers/gemini_client.py']},
        {id:'xai',name:'xAI Grok',description:'Grok models',compatible:['langchain','crewai'],commands:['pip install groq'],configFiles:['providers/xai_client.py']},
        {id:'ollama',name:'Ollama',description:'Local models runtime',compatible:['langchain','crewai','semantic-kernel'],commands:[],configFiles:['providers/ollama_client.py']},
      ],
      protocols: [
        {id:'mcp',name:'MCP',description:'Model Context Protocol integration',compatible:['openai','anthropic','langchain','postgresql'],commands:['npm install mcp-sdk'],configFiles:['agents/mcp/client.js']},
        {id:'swarm',name:'Swarm',description:'Lightweight agent protocol concept',compatible:['openai','anthropic'],commands:[],configFiles:['agents/swarm/readme.md']},
      ],
      templates: [
        {id:'ai-chatbot',name:'AI Chatbot',description:'Streaming chat UI + provider adapter',preset:{frontend:['react'],backend:['express'],aiFrameworks:['langchain'],llmProviders:['openai'],protocols:[]}},
        {id:'rag-service',name:'RAG Service',description:'Embedding + vector search API',preset:{backend:['fastapi'],aiFrameworks:['langchain'],llmProviders:['openai'],protocols:[]}},
        {id:'web-research',name:'Web Research Agent',description:'Planning + browsing tools',preset:{frontend:['react'],backend:['express'],aiFrameworks:['crewai'],llmProviders:['openai'],protocols:['mcp']}},
        {id:'process-automator',name:'Process Automator',description:'Role agents for workflows',preset:{backend:['fastapi'],aiFrameworks:['crewai'],llmProviders:['anthropic'],protocols:[]}},
        {id:'code-assistant-mcp',name:'Code Assistant + MCP',description:'Dev agent w/ repo tools',preset:{frontend:['react'],backend:['express'],aiFrameworks:['langchain'],llmProviders:['anthropic'],protocols:['mcp']}},
        {id:'multimodal-assistant',name:'Multimodal Assistant',description:'Image + text reasoning',preset:{frontend:['react'],backend:['fastapi'],aiFrameworks:['langchain'],llmProviders:['gemini'],protocols:[]}},
        {id:'local-first',name:'Local-first App',description:'Offline dev w/ Ollama',preset:{frontend:['react'],backend:['express'],aiFrameworks:['langchain'],llmProviders:['ollama'],protocols:[]}},
      ]
    };

    const CATEGORY_LABELS = {
      frontend:'Frontend', backend:'Backend', database:'Database', tools:'Dev Tools', aiFrameworks:'AI Frameworks', llmProviders:'LLM Providers', protocols:'Protocols'
    };

    /************************************\n     * Helpers                          *
     ************************************/
    const deepClone = obj => JSON.parse(JSON.stringify(obj));

    function checkCompatibility(selected){
      const conflicts=[]; const warnings=[];
      // Basic frontend-backend compatibility
      selected.frontend.forEach(fid=>{selected.backend.forEach(bid=>{
        const f=TECH_STACK.frontend.find(t=>t.id===fid); const b=TECH_STACK.backend.find(t=>t.id===bid);
        if(f && b){
          const frontOk = f.compatible.includes(bid) || f.compatible.includes('*');
            const backOk = b.compatible.includes(fid) || b.compatible.includes('*');
          if(!frontOk && !backOk){conflicts.push(`${f.name} may not pair cleanly with ${b.name}`);} }
      });});
      // AI warnings
      selected.aiFrameworks.forEach(aid=>{const af=TECH_STACK.aiFrameworks.find(a=>a.id===aid); if(!af) return; selected.llmProviders.forEach(pid=>{if(!af.compatible.includes(pid)){warnings.push(`${af.name} not validated for provider ${pid} – check docs.`);}});});
      // MCP requirement sample
      if(selected.protocols.includes('mcp') && !selected.llmProviders.some(p=>['openai','anthropic'].includes(p))){warnings.push('MCP usually paired with OpenAI or Anthropic for richer tool calling.');}
      return {conflicts,warnings};
    }

    function generateEnv(selected){
      let lines=[]; if(selected.llmProviders.includes('openai')) lines.push('OPENAI_API_KEY=');
      if(selected.llmProviders.includes('anthropic')) lines.push('ANTHROPIC_API_KEY=');
      if(selected.llmProviders.includes('gemini')) lines.push('GEMINI_API_KEY=');
      if(selected.llmProviders.includes('xai')) lines.push('XAI_API_KEY=');
      if(selected.llmProviders.includes('ollama')) lines.push('OLLAMA_HOST=localhost');
      lines.push('NODE_ENV=development');
      return lines.join('\n');
    }

    function generateReadme(cfg){
      return `# ${cfg.projectName}\n\nGenerated with **GenAppXpress**.\n\n## Selected Stack\n${Object.keys(CATEGORY_LABELS).map(cat=>{const arr=cfg[cat]; if(!arr||!arr.length) return ''; return `- **${CATEGORY_LABELS[cat]}:** ${arr.join(', ')}`;}).filter(Boolean).join('\n')}\n\n## Getting Started\nRun the generated setup script or follow manual steps.\n\n## AI Notes\nIf using AI providers set the API keys in .env before running agent scripts.\n`;}

    function generateStructure(cfg){
      const useTS = cfg.tools.includes('typescript');
      const reactSelected = cfg.frontend.includes('react');
      const vueSelected = cfg.frontend.includes('vue');
      const nextSelected = cfg.frontend.includes('nextjs');
      const expressSelected = cfg.backend.includes('express');
      const fastapiSelected = cfg.backend.includes('fastapi');

      const pkg = {
        name: cfg.projectName,
        private: true,
        type: 'module',
        scripts: {
          ...(reactSelected || vueSelected ? { dev: 'vite', build: 'vite build', preview: 'vite preview' } : {}),
          ...(nextSelected ? { dev: 'next dev', build: 'next build', start: 'next start' } : {}),
          ...(expressSelected ? { server: 'node server/server.js' } : {}),
          ...(fastapiSelected ? { api: 'uvicorn api.main:app --reload' } : {}),
        },
        dependencies: {},
        devDependencies: {}
      };
      function addDep(n,v='latest'){pkg.dependencies[n]=v;}
      function addDev(n,v='latest'){pkg.devDependencies[n]=v;}
      if(reactSelected){ addDep('react'); addDep('react-dom'); addDep('vite'); }
      if(vueSelected){ addDep('vue'); addDep('vite'); }
      if(nextSelected){ addDep('next'); addDep('react'); addDep('react-dom'); }
      if(expressSelected){ addDep('express'); addDep('cors'); addDep('helmet'); }
      if(cfg.database.includes('postgresql')) addDep('pg');
      if(cfg.database.includes('mongodb')) addDep('mongoose');
      if(cfg.database.includes('redis')) addDep('ioredis');
      if(cfg.protocols.includes('mcp')) addDep('mcp-sdk');
      if(cfg.tools.includes('eslint')) addDev('eslint');
      if(useTS){ addDev('typescript'); if(expressSelected) addDev('@types/express'); if(reactSelected){addDev('@types/react'); addDev('@types/react-dom');}}

      const srcDir = {};
  if(reactSelected){ const appFile=useTS?'App.tsx':'App.jsx'; const mainFile=useTS?'main.tsx':'main.jsx'; srcDir[appFile]=`import React from 'react';\nexport default function App(){\n  return (<div style={{fontFamily:'sans-serif',padding:32}}><h1>${cfg.projectName}</h1><p>Generated with GenAppXpress.</p></div>);\n}`; srcDir[mainFile]=`import React from 'react';\nimport { createRoot } from 'react-dom/client';\nimport App from './${appFile}';\nconst rootEl = document.getElementById('root');\nif(rootEl){ createRoot(rootEl).render(<App />); }`; }
      if(vueSelected){ srcDir['main.js'] = `import { createApp } from 'vue';\nconst App={template:'<div style=\\"font-family:sans-serif;padding:32\\"><h1>${cfg.projectName}</h1><p>Generated with GenAppXpress (Vue).</p></div>'};\ncreateApp(App).mount('#root');`; }
      if(nextSelected){ srcDir['pages']={ 'index.js': `export default function Home(){return (<main style={{fontFamily:'sans-serif',padding:32}}><h1>${cfg.projectName}</h1><p>Generated with GenAppXpress (Next.js).</p></main>);}`}; srcDir['next.config.js']=`export default {};`; }
  // Build index.html content; split closing script tag to avoid ending this inline script block
  const indexHtml = (reactSelected || vueSelected) ? { 'index.html': [
    '<!DOCTYPE html>',
    '<html>',
    '<head>',
    '  <meta charset="UTF-8">',
    `  <title>${cfg.projectName}</title>`,
    '</head>',
    '<body>',
    '  <div id="root"></div>',
    '  <script type="module" src="' + (reactSelected ? (useTS ? 'src/main.tsx' : 'src/main.jsx') : 'src/main.js') + '"></' + 'script>',
    '</body>',
    '</html>'
  ].join('\n') } : {};

      const serverDir = expressSelected ? { 'server.js': `import express from 'express';\nimport cors from 'cors';\nimport helmet from 'helmet';\nconst app=express();\napp.use(helmet());\napp.use(cors());\napp.use(express.json());\napp.get('/api/health',(_req,res)=>res.json({ok:true}));\nconst port=process.env.PORT||3001;\napp.listen(port,()=>console.log('Express server running on '+port));` } : undefined;
      const apiDir = fastapiSelected ? { 'main.py': `from fastapi import FastAPI\nfrom pydantic import BaseModel\nimport os\napp=FastAPI()\nclass Echo(BaseModel):\n    message: str\n@app.get('/health')\nasync def health():\n    return {'ok': True}\n@app.post('/echo')\nasync def echo(payload: Echo):\n    return {'echo': payload.message}\nif __name__=='__main__':\n    import uvicorn\n    uvicorn.run(app, host='0.0.0.0', port=int(os.getenv('PORT',8000)))` } : undefined;

      const dbDir = cfg.database.length ? {} : undefined;
      if(dbDir){ if(cfg.database.includes('postgresql')) dbDir['schema.sql'] = `-- Example PostgreSQL schema\nCREATE TABLE IF NOT EXISTS items (id SERIAL PRIMARY KEY, name TEXT NOT NULL);`; if(cfg.database.includes('mongodb')) dbDir['models']={'index.js':`import mongoose from 'mongoose';\nconst ItemSchema=new mongoose.Schema({name:String});\nexport const Item=mongoose.model('Item',ItemSchema);`}; if(cfg.database.includes('redis')) dbDir['redis.js']=`import Redis from 'ioredis';\nexport const redis=new Redis(process.env.REDIS_URL||'redis://localhost:6379');`; }

      const providersDir = cfg.llmProviders.length ? {} : undefined;
      if(providersDir){ if(cfg.llmProviders.includes('openai')) providersDir['openai_client.py'] = `from openai import OpenAI\nimport os\nclient=OpenAI(api_key=os.getenv('OPENAI_API_KEY'))\nif __name__=='__main__':\n    resp=client.chat.completions.create(model='gpt-4o-mini', messages=[{'role':'user','content':'Hello from OpenAI'}])\n    print(resp.choices[0].message.content)`; if(cfg.llmProviders.includes('anthropic')) providersDir['anthropic_client.py']=`import anthropic, os\nclient=anthropic.Anthropic(api_key=os.getenv('ANTHROPIC_API_KEY'))\nif __name__=='__main__':\n    msg=client.messages.create(model='claude-3-5-sonnet', max_tokens=50, messages=[{'role':'user','content':'Hello from Anthropic'}])\n    print(msg.content[0].text)`; if(cfg.llmProviders.includes('gemini')) providersDir['gemini_client.py']=`import google.generativeai as genai, os\ngenai.configure(api_key=os.getenv('GEMINI_API_KEY'))\nif __name__=='__main__':\n    model=genai.GenerativeModel('gemini-1.5-flash')\n    resp=model.generate_content('Hello from Gemini')\n    print(resp.text)`; if(cfg.llmProviders.includes('xai')) providersDir['xai_client.py']=`from groq import Groq\nimport os\nclient=Groq(api_key=os.getenv('XAI_API_KEY'))\nif __name__=='__main__':\n    resp=client.chat.completions.create(model='grok-beta', messages=[{'role':'user','content':'Hello from Grok'}])\n    print(resp.choices[0].message.content)`; if(cfg.llmProviders.includes('ollama')) providersDir['ollama_client.py']=`import requests, os, json\nbase=os.getenv('OLLAMA_HOST','http://localhost:11434')\nif __name__=='__main__':\n    r=requests.post(base+'/api/generate', json={'model':'llama3','prompt':'Hello from Ollama'})\n    print(r.json())`; }

      const frameworkDir = (cfg.aiFrameworks.length||providersDir) ? {} : undefined;
      if(frameworkDir){ if(cfg.aiFrameworks.includes('langchain')) frameworkDir['agent_langchain.py']=`import os\nfrom langchain_openai import ChatOpenAI\nllm=ChatOpenAI(api_key=os.getenv('OPENAI_API_KEY'), model='gpt-4o-mini')\nif __name__=='__main__':\n    print(llm.invoke('Hello from LangChain'))`; if(cfg.aiFrameworks.includes('crewai')) frameworkDir['agent_crewai.py']=`# CrewAI scaffold\nif __name__=='__main__':\n    print('CrewAI scaffold ready')`; if(cfg.aiFrameworks.includes('langgraph')) frameworkDir['agent_langgraph.py']=`# LangGraph scaffold\nif __name__=='__main__':\n    print('LangGraph scaffold ready')`; if(cfg.aiFrameworks.includes('semantic-kernel')) frameworkDir['agent_sk.py']=`# Semantic Kernel scaffold\nif __name__=='__main__':\n    print('Semantic Kernel scaffold ready')`; if(cfg.aiFrameworks.includes('autogen')) frameworkDir['agent_autogen.py']=`# AutoGen scaffold\nif __name__=='__main__':\n    print('AutoGen scaffold ready')`; }
      const protocolDir = cfg.protocols.includes('mcp') ? { 'mcp': { 'client.js': `// Minimal MCP client stub` } } : undefined;
      const eslintFile = cfg.tools.includes('eslint') ? { '.eslintrc.cjs': `module.exports={env:{browser:true,es2021:true,node:true},extends:['eslint:recommended'${reactSelected?',"plugin:react/recommended"':''}],parserOptions:{ecmaVersion:12,sourceType:'module'},rules:{}};` } : {};
      const tsConfig = useTS ? { 'tsconfig.json': JSON.stringify({ compilerOptions:{target:'ES2020',module:'ESNext',jsx:'react-jsx',moduleResolution:'Node',esModuleInterop:true,strict:true,skipLibCheck:true}, include:['src'] }, null, 2)} : {};
      const dockerFiles = cfg.tools.includes('docker') ? { 'Dockerfile': `FROM node:20-alpine\nWORKDIR /app\nCOPY package*.json ./\nRUN npm install\nCOPY . .\nCMD [\"npm\",\"run\",\"dev\"]`, 'docker-compose.yml': `version: '3.9'\nservices:\n  app:\n    build: .\n    ports:\n      - '5173:5173'\n      - '3001:3001'\n    environment:\n      - NODE_ENV=development` } : {};
  // Derive Python requirements if any Python-based components selected
  const pyPackages = new Set();
  if(fastapiSelected) { pyPackages.add('fastapi'); pyPackages.add('uvicorn'); }
  cfg.llmProviders.forEach(id=>{ if(id==='openai') pyPackages.add('openai'); if(id==='anthropic') pyPackages.add('anthropic'); if(id==='gemini') pyPackages.add('google-generativeai'); if(id==='xai') pyPackages.add('groq'); if(id==='ollama') pyPackages.add('requests'); });
  cfg.aiFrameworks.forEach(id=>{ if(id==='langchain') pyPackages.add('langchain'); if(id==='crewai') pyPackages.add('crewai'); if(id==='langgraph') pyPackages.add('langgraph'); if(id==='semantic-kernel') pyPackages.add('semantic-kernel'); if(id==='autogen') pyPackages.add('pyautogen'); });
  const requirementsFile = pyPackages.size ? { 'requirements.txt': Array.from(pyPackages).sort().join('\n')+'\n' } : {};
  const base = { [cfg.projectName]: { 'README.md': generateReadme(cfg), '.env': generateEnv(cfg), 'package.json': JSON.stringify(pkg,null,2), ...eslintFile, ...tsConfig, ...dockerFiles, ...indexHtml, ...requirementsFile, ...(Object.keys(srcDir).length?{src:srcDir}:{}), ...(serverDir?{server:serverDir}:{}), ...(apiDir?{api:apiDir}:{}), ...(dbDir?{database:dbDir}:{}), ...(providersDir||frameworkDir?{agents:{...(frameworkDir||{}), providers:providersDir||{}, ...(protocolDir||{})}}:{}), } }; return base; }

    function generateScript(cfg){
      const date=new Date().toISOString().split('T')[0];
      const pyDeps=new Set(); const nodeDeps=new Set();
      if(cfg.backend.includes('express')) ['express','cors','helmet'].forEach(d=>nodeDeps.add(d));
      if(cfg.frontend.includes('react')) ['react','react-dom','vite'].forEach(d=>nodeDeps.add(d));
      if(cfg.frontend.includes('vue')) ['vue','vite'].forEach(d=>nodeDeps.add(d));
      if(cfg.frontend.includes('nextjs')) ['next','react','react-dom'].forEach(d=>nodeDeps.add(d));
      if(cfg.database.includes('postgresql')) nodeDeps.add('pg');
      if(cfg.database.includes('mongodb')) nodeDeps.add('mongoose');
      if(cfg.database.includes('redis')) nodeDeps.add('ioredis');
      if(cfg.protocols.includes('mcp')) nodeDeps.add('mcp-sdk');
      if(cfg.tools.includes('eslint')) nodeDeps.add('eslint');
      if(cfg.tools.includes('typescript')) ['typescript','@types/node'].forEach(d=>nodeDeps.add(d));
      cfg.aiFrameworks.forEach(id=>{const f=TECH_STACK.aiFrameworks.find(t=>t.id===id); if(f) f.commands.forEach(c=>{if(c.startsWith('pip ')) c.replace('pip install','').trim().split(/\s+/).forEach(p=>pyDeps.add(p));});});
      cfg.llmProviders.forEach(id=>{const p=TECH_STACK.llmProviders.find(t=>t.id===id); if(p) p.commands.forEach(c=>{if(c.startsWith('pip ')) c.replace('pip install','').trim().split(/\s+/).forEach(q=>pyDeps.add(q));});});
      const lines=['#!/usr/bin/env bash','# Generated by GenAppXpress',`# Date: ${date}`,'set -e','',`echo "[INFO] Creating project ${cfg.projectName}"`,`mkdir -p ${cfg.projectName}`,'cd '+cfg.projectName,'echo "[INFO] Installing Node dependencies"','npm install '+(nodeDeps.size?Array.from(nodeDeps).join(' '):'react')];
      if(pyDeps.size){ lines.push('echo "[INFO] Setting up Python virtual environment"','python3 -m venv .venv || python -m venv .venv','source .venv/bin/activate','pip install '+Array.from(pyDeps).join(' ')); }
  const envContent = generateEnv(cfg).replace(/`/g,'\`');
  lines.push('echo "[INFO] Writing .env"',`printf '%s\n' "${envContent.split('\n').join('\\n')}" > .env`);
      if(cfg.backend.includes('fastapi')) lines.push('echo "[INFO] To run FastAPI: source .venv/bin/activate && uvicorn api.main:app --reload"');
      if(cfg.backend.includes('express')) lines.push('echo "[INFO] To run Express: npm run server"');
      if(cfg.frontend.includes('react')||cfg.frontend.includes('vue')) lines.push('echo "[INFO] To run Frontend: npm run dev"');
      if(cfg.frontend.includes('nextjs')) lines.push('echo "[INFO] To run Next.js: npm run dev"');
      lines.push('echo "[DONE] Scaffold complete"');
      return lines.join('\n');
    }

    function flattenStructure(struct, prefix=''){ const files=[]; Object.entries(struct||{}).forEach(([name,val])=>{const path= prefix? prefix+name: name; if(typeof val === 'string'){files.push(path);} else if(val && typeof val === 'object'){files.push(path+'/'); files.push(...flattenStructure(val, path+'/'));}}); return files; }

    async function exportZip(cfg){
      const structure = generateStructure(cfg);
      const zip = new JSZip();
      // Add all files, applying edited overrides if present
      function add(obj, base='') {
        Object.entries(obj).forEach(([k,v])=>{
          if(v === undefined) return;
          if(typeof v === 'string') {
            const fullPath = base + k; // e.g. projectName/README.md
            const override = (window.__editedOverrides && window.__editedOverrides[fullPath]);
            zip.file(fullPath, override !== undefined ? override : v);
          } else if(v && typeof v==='object') {
            add(v, base+k+'/');
          }
        });
      }
      add(structure);
      zip.file('setup.sh', generateScript(cfg));
      const blob = await zip.generateAsync({type:'blob'});
      saveAs(blob, `${cfg.projectName}-scaffold.zip`);
    }

    /************************************\n     * Components                        *
     ************************************/

    const StepIndicators = ({currentStep, steps, setStep}) => (
      <div className="steps-bar" role="tablist" aria-label="Wizard Steps">
        {steps.map((label,i)=>{const step=i+1; const state= step===currentStep?'active': (step<currentStep?'completed':''); return (
          <button key={label} className={"step-indicator "+state} aria-selected={step===currentStep} aria-label={`Step ${step}: ${label}`} onClick={()=>setStep(step)}>{step}</button>
        );})}
      </div>
    );

    const TechOption = ({tech, category, isSelected, onToggle, isIncompatible}) => (
      <div className={"tech-option "+(isSelected?'selected ':'')+(isIncompatible?'incompatible':'')} role="checkbox" aria-checked={isSelected} aria-label={tech.name+(isIncompatible? ' incompatible':'')} tabIndex={isIncompatible?-1:0} onKeyDown={(e)=>{if(e.key==='Enter'||e.key===' '){e.preventDefault(); !isIncompatible && onToggle(category, tech.id);}}} onClick={()=>!isIncompatible && onToggle(category, tech.id)}>
        <div className="checkbox">{isSelected?'✓':''}</div>
        <h4>{tech.name}</h4>
        <p>{tech.description}</p>
        <div className="badge-bar">
          {tech.compatible && tech.compatible.slice(0,3).map(c => <span key={c} className="tag" title="Compatible tag">{c}</span>)}
        </div>
      </div>
    );

    const TemplateModal = ({onClose, applyTemplate}) => {
      const list = TECH_STACK.templates;
      return (
        <div className="template-modal" role="dialog" aria-modal="true" aria-label="Template Selection">
          <div className="template-dialog">
            <button className="close-btn" onClick={onClose} aria-label="Close template dialog">Close</button>
            <h2 style={{marginTop:0}}>Templates</h2>
            <p style={{marginTop:-8}}>Choose a predefined stack (includes AI selections).</p>
            <div className="template-grid">
              {list.map(t => (
                <div className="template-card" key={t.id}>
                  <h4>{t.name}</h4>
                  <p>{t.description}</p>
                  <button onClick={()=>applyTemplate(t.preset)}>Use</button>
                </div>
              ))}
            </div>
          </div>
        </div>
      );
    };

    const FileTree = ({cfg, activeFile, onSelect, editedOverrides}) => {
      const structure = useMemo(()=>generateStructure(cfg),[cfg]);
      const files = flattenStructure(structure);
      const getContent = (path) => {
        const parts = path.split('/').filter(Boolean);
        let node = structure;
        for (let i=0;i<parts.length;i++) { const part = parts[i]; if(!node) return ''; node = node[part]; }
        return typeof node === 'string' ? node : '';
      };
      return <div className="file-tree" aria-label="File tree preview">{files.map(f=> {
        const isDir = f.endsWith('/');
        const isActive = f === activeFile;
        const modified = !isDir && editedOverrides && Object.prototype.hasOwnProperty.call(editedOverrides,f);
        return <div key={f}> <button type="button" className={"tree-entry "+(isDir? 'dir ':'')+(isActive?'active':'')} disabled={isDir} onClick={()=>!isDir && onSelect && onSelect(f, modified? editedOverrides[f] : getContent(f))} aria-label={(isDir?'Directory ':'File ')+f+(modified?' (modified)':'')}>{f}{modified && ' *'}</button> </div>;
      })}</div>;
    };

    const ScriptPreview = ({cfg}) => {
      const script = useMemo(()=>generateScript(cfg),[cfg]);
      return <pre className="code-block" aria-label="Script Preview">{script}</pre>;
    };

    const MultiSelectCategory = ({category, selected, onToggle, computeIncompat}) => {
      const items = TECH_STACK[category] || [];
      return (
        <div className="section" aria-labelledby={`heading-${category}`}>
          <h2 id={`heading-${category}`}>{CATEGORY_LABELS[category]}</h2>
          <div className="tech-grid">
            {items.map(item => {
              const isSelected = selected.includes(item.id);
              const isIncompatible = computeIncompat && computeIncompat(category,item);
              return <TechOption key={item.id} tech={item} category={category} isSelected={isSelected} onToggle={onToggle} isIncompatible={isIncompatible} />;
            })}
          </div>
        </div>
      );
    };

    const CodeEditor = ({path, original, value, onChange, showDiff}) => {
      const textRef = React.useRef(null); const overlayRef = React.useRef(null);
      const [manualLang,setManualLang] = React.useState('auto');
      function guess(p){ if(/\.py$/.test(p)) return 'python'; if(/\.jsx?$/.test(p)) return 'javascript'; if(/\.sh$/.test(p)) return 'bash'; if(/\.json$/.test(p)) return 'json'; if(/\.ya?ml$/.test(p)) return 'yaml'; return null; }
      React.useEffect(()=>{ if(!overlayRef.current) return; try { const guessed=guess(path); const lang = manualLang==='auto'? guessed : manualLang; let res; if(lang && window.hljs){ res = hljs.highlight(value||'', {language: (lang==='yaml'?'json':lang)}); } else if(window.hljs){ res = hljs.highlightAuto(value||''); } overlayRef.current.innerHTML = (res && res.value ? res.value : (value||'')) + '\n'; } catch(e){ overlayRef.current.textContent = (value||'')+'\n'; } }, [value, path, manualLang]);
      React.useEffect(()=>{ const t=textRef.current, o=overlayRef.current; if(!t||!o) return; function sync(){o.scrollTop=t.scrollTop; o.scrollLeft=t.scrollLeft;} t.addEventListener('scroll',sync); return ()=>t.removeEventListener('scroll',sync); },[]);
      const diffLines = React.useMemo(()=>{ if(!showDiff) return []; const oldL=(original||'').split(/\r?\n/); const newL=(value||'').split(/\r?\n/); const m=oldL.length,n=newL.length; const dp=Array.from({length:m+1},()=>Array(n+1).fill(0)); for(let i=1;i<=m;i++) for(let j=1;j<=n;j++) dp[i][j]= oldL[i-1]===newL[j-1]? dp[i-1][j-1]+1: Math.max(dp[i-1][j],dp[i][j-1]); const ops=[]; let i=m,j=n; while(i>0&&j>0){ if(oldL[i-1]===newL[j-1]){ ops.push({type:'ctx', line:oldL[i-1]}); i--; j--; } else if(dp[i-1][j]>=dp[i][j-1]) { ops.push({type:'del', line:oldL[i-1]}); i--; } else { ops.push({type:'add', line:newL[j-1]}); j--; } } while(i>0){ ops.push({type:'del', line:oldL[i-1]}); i--; } while(j>0){ ops.push({type:'add', line:newL[j-1]}); j--; } return ops.reverse(); }, [showDiff, original, value]);
      return React.createElement(React.Fragment,null,
        React.createElement('div',{className:'code-editor'},
          React.createElement('div',{style:{position:'absolute', top:4, right:8, zIndex:3}},
            React.createElement('label',{style:{fontSize:'11px', display:'flex', alignItems:'center', gap:4}},
              React.createElement('span',null,'Lang:'),
              React.createElement('select',{value:manualLang,onChange:e=>setManualLang(e.target.value),style:{fontSize:'11px'}},
                ['auto','javascript','python','bash','json','yaml','markdown'].map(l=>React.createElement('option',{key:l,value:l},l))
              )
            )
          ),
          React.createElement('pre',{ref:overlayRef,className:'hljs-overlay','aria-hidden':'true'}),
          React.createElement('textarea',{ref:textRef,value:value,spellCheck:false,'aria-label':'Edit '+path,onChange:e=>onChange(e.target.value)})
        ),
        showDiff && React.createElement('div',{className:'diff-view','aria-label':'Diff view'}, diffLines.map((d,i)=>React.createElement('div',{key:i,className:'diff-line '+d.type}, React.createElement('span',{className:'ln'}, d.type==='add'?'+': d.type==='del'?'-':''), React.createElement('code',null,d.line||'\u00A0'))))
      );
    };

    const App = () => {
      const [currentStep,setCurrentStep]=useState(1);
      const [projectName,setProjectName]=useState('my-awesome-project');
      const [description,setDescription]=useState('An awesome project generated by GenAppXpress');
      const [author,setAuthor]=useState('');
      const [license,setLicense]=useState('MIT');
      const [showTemplates,setShowTemplates]=useState(false);
      const [darkMode,setDarkMode]=useState(document.documentElement.getAttribute('data-color-scheme')==='dark');
  const emptySelection = {frontend:[], backend:[], database:[], tools:[], aiFrameworks:[], llmProviders:[], protocols:[]};
  const [selected,setSelected]=useState(emptySelection);
  const [previewFile,setPreviewFile] = useState(()=>localStorage.getItem('genappxpress-last-preview')||null);
  const [previewContent,setPreviewContent] = useState('');
  const [originalContent,setOriginalContent] = useState('');
  const [editedOverrides,setEditedOverrides] = useState({});
  const [editMode,setEditMode] = useState(false);
  const [showDiff,setShowDiff] = useState(false);

      const onToggle=(category,id)=>{setSelected(prev=>{const list=prev[category]; const exists=list.includes(id); return {...prev,[category]: exists? list.filter(x=>x!==id): [...list,id]};});};
      const applyTemplate = (preset)=>{ setSelected(prev=> ({...prev, ...Object.fromEntries(Object.keys(emptySelection).map(k=>[k, preset[k] || prev[k]]))})); setShowTemplates(false); };

      const cfg = useMemo(()=>({projectName, description, author, license, ...selected}),[projectName, description, author, license, selected]);
      const {conflicts,warnings}=useMemo(()=>checkCompatibility(selected),[selected]);

      const computeIncompat = function(category, item) {
        if (category === 'frontend') {
          if (selected.backend.length) {
            return selected.backend.some(function(b) {
              var back = TECH_STACK.backend.find(function(t) { return t.id === b; });
              var ok = (back && back.compatible && back.compatible.indexOf(item.id) !== -1)
                || (item.compatible && item.compatible.indexOf(b) !== -1)
                || (item.compatible && item.compatible.indexOf('*') !== -1);
              return !ok;
            });
          }
        }
        return false;
      };

      const toggleTheme=()=>{const mode = !darkMode?'dark':'light'; setDarkMode(!darkMode); document.documentElement.setAttribute('data-color-scheme',mode); localStorage.setItem('genappxpress-theme',mode);};

      const canNext = () => {
        if(currentStep===1) return projectName.trim().length>2; if(currentStep===2) return Object.values(selected).some(a=>a.length); return true; };

  const handleSelectFile=(p,c)=>{setPreviewFile(p); localStorage.setItem('genappxpress-last-preview', p); setOriginalContent(c); setPreviewContent(editedOverrides[p]||c); setEditMode(false); setShowDiff(false);};
  const handleEditChange=(val)=>{ setPreviewContent(val); if(previewFile){ setEditedOverrides(prev=>({...prev,[previewFile]:val})); } };
  // Expose overrides globally for exportZip merging
  React.useEffect(()=>{ window.__editedOverrides = editedOverrides; }, [editedOverrides]);
  const downloadCurrent=()=>{ if(!previewFile) return; const blob=new Blob([previewContent],{type:'text/plain'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=previewFile.split('/').pop(); a.click(); setTimeout(()=>URL.revokeObjectURL(a.href),4000); };
  return (
        <div className="app-shell">
          <header>
            <div className="logo" aria-hidden>GX</div>
            <div className="title-block">
              <h1>GenAppXpress <span className="pill">ALPHA</span></h1>
              <div className="tagline">Visual full‑stack & agentic AI scaffolding · Export scripts & project files</div>
            </div>
            <button className="theme-toggle" onClick={toggleTheme} aria-label="Toggle color theme">{darkMode? 'Light Mode':'Dark Mode'}</button>
            <button className="secondary" onClick={()=>setShowTemplates(true)}>Templates</button>
          </header>

          <div className="wizard">
            <StepIndicators currentStep={currentStep} steps={['Project','Tech Stack','Summary','Generate']} setStep={setCurrentStep} />
            <div className="wizard-panels">
              <div className={"wizard-step "+(currentStep===1?'active':'')}>
                <div className="section">
                  <h2>Project Configuration</h2>
                  <div className="inline-fields">
                    <div className="field"><label htmlFor="name">Project Name</label><input id="name" value={projectName} onChange={e=>setProjectName(e.target.value)} placeholder="my-project" /></div>
                    <div className="field"><label htmlFor="author">Author</label><input id="author" value={author} onChange={e=>setAuthor(e.target.value)} placeholder="Your Name" /></div>
                    <div className="field"><label htmlFor="license">License</label><select id="license" value={license} onChange={e=>setLicense(e.target.value)}><option>MIT</option><option>Apache-2.0</option><option>GPL-3.0</option><option>ISC</option></select></div>
                  </div>
                  <div className="field" style={{marginTop:16}}><label htmlFor="desc">Description</label><textarea id="desc" value={description} onChange={e=>setDescription(e.target.value)} placeholder="Short project description" /></div>
                </div>
              </div>
              <div className={"wizard-step "+(currentStep===2?'active':'')}>
                <MultiSelectCategory category="frontend" selected={selected.frontend} onToggle={onToggle} computeIncompat={computeIncompat} />
                <MultiSelectCategory category="backend" selected={selected.backend} onToggle={onToggle} computeIncompat={computeIncompat} />
                <MultiSelectCategory category="database" selected={selected.database} onToggle={onToggle} />
                <MultiSelectCategory category="tools" selected={selected.tools} onToggle={onToggle} />
                <MultiSelectCategory category="aiFrameworks" selected={selected.aiFrameworks} onToggle={onToggle} />
                <MultiSelectCategory category="llmProviders" selected={selected.llmProviders} onToggle={onToggle} />
                <MultiSelectCategory category="protocols" selected={selected.protocols} onToggle={onToggle} />
              </div>
              <div className={"wizard-step "+(currentStep===3?'active':'')}>
                <div className="summary-columns">
                  <div className="summary-left section">
                    <h2>Summary & Compatibility</h2>
                    <p style={{marginTop:-4}}>Review your selections and adjust before generation.</p>
                    <div className="grid" style={{marginTop:20}}>
                      {Object.keys(CATEGORY_LABELS).map(cat=> cfg[cat] && cfg[cat].length>0 && (
                        <div key={cat}>
                          <strong>{CATEGORY_LABELS[cat]}</strong>: {cfg[cat].join(', ')}
                        </div>
                      ))}
                    </div>
                    <div style={{marginTop:20, display:'grid', gap:12}}>
                      {conflicts.map((c,i)=><div key={i} className="error" role="alert"><strong>Conflict:</strong> {c}</div>)}
                      {warnings.map((w,i)=><div key={i} className="warning" role="alert"><strong>Note:</strong> {w}</div>)}
                      {(!conflicts.length && !warnings.length) && <div className="warning" style={{background:'rgba(33,128,141,0.12)', borderColor:'rgba(33,128,141,0.4)', color:'var(--color-primary)'}}><strong>Great!</strong> No compatibility flags detected.</div>}
                    </div>
                  </div>
                  <div className="summary-right section" aria-label="File Tree and Preview" role="region">
                    <h2 style={{marginTop:0}}>File Tree & Preview</h2>
                    <div className="file-preview-layout">
                      <div className="file-tree-pane" aria-label="File tree" role="tree">
                        <FileTree cfg={cfg} activeFile={previewFile} onSelect={handleSelectFile} editedOverrides={editedOverrides} />
                      </div>
                      <div className="file-preview-pane" aria-label="File preview" role="group">
                        {previewFile ? (
                          <React.Fragment>
                            <div className="editor-toolbar">
                              <strong style={{fontSize:'12px', flex:1, overflow:'hidden', textOverflow:'ellipsis'}}>{previewFile}{editedOverrides[previewFile]?' *':''}</strong>
                              <button type="button" onClick={()=>setEditMode(m=>!m)}>{editMode?'Read Only':'Edit'}</button>
                              <button type="button" disabled={!editMode} onClick={()=>setShowDiff(d=>!d)}>{showDiff?'Hide Diff':'Show Diff'}</button>
                              <button type="button" onClick={downloadCurrent}>Download</button>
                            </div>
                            {editMode ? (
                              <CodeEditor path={previewFile} original={originalContent} value={previewContent} onChange={handleEditChange} showDiff={showDiff} />
                            ) : (
                              <pre className="preview-content hljs" aria-label={`Contents of ${previewFile}`} dangerouslySetInnerHTML={{__html:(function(){ try { return (window.hljs && hljs.highlightAuto(previewContent||'').value) || (previewContent||''); } catch(e){ return previewContent || ''; } })()}} />
                            )}
                          </React.Fragment>
                        ) : <div className="preview-placeholder">Select a file to preview its contents.</div>}
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div className={"wizard-step "+(currentStep===4?'active':'')}>
                <div className="section">
                  <h2>Generated Setup Script</h2>
                  <ScriptPreview cfg={cfg} />
                  <div style={{marginTop:16, display:'flex', gap:12, flexWrap:'wrap'}}>
                    <button onClick={()=>navigator.clipboard.writeText(generateScript(cfg))}>Copy Script</button>
                    <button className="secondary" onClick={()=>exportZip(cfg)}>Download ZIP</button>
                  </div>
                </div>
                <div className="section">
                  <h2>Next Steps</h2>
                  <ol style={{lineHeight:1.6}}>
                    <li>Download and run <code>setup.sh</code>.</li>
                    <li>Fill in API keys inside <code>.env</code>.</li>
                    <li>Activate Python venv if using AI frameworks.</li>
                    <li>Start backend & frontend dev servers.</li>
                    <li>Build amazing agentic application 🚀</li>
                  </ol>
                </div>
              </div>
            </div>
            <div className="actions-bar">
              <div className="nav-buttons">
                <button className="secondary" disabled={currentStep===1} onClick={()=>setCurrentStep(s=>Math.max(1,s-1))}>Back</button>
                {currentStep<4 && <button disabled={!canNext()} onClick={()=>setCurrentStep(s=>Math.min(4,s+1))}>{currentStep===3?'Generate':'Next'}</button>}
              </div>
              {currentStep===4 && <button onClick={()=>{setCurrentStep(1); setSelected(emptySelection);}} className="ghost">Start Over</button>}
            </div>
          </div>
          {showTemplates && <TemplateModal onClose={()=>setShowTemplates(false)} applyTemplate={applyTemplate} />}
          <div className="footer-note">GenAppXpress – Instant full-stack & AI agent scaffolding • v0.1.0</div>
        </div>
      );
    };

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
